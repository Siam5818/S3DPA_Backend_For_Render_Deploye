# ğŸ—ï¸ Architecture Visuelle du Pipeline S3DPA

## Vue d'Ensemble ComplÃ¨te

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SYSTÃˆME S3DPA                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              IoT / Capteurs
                                   â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚               â”‚               â”‚
              â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
              â”‚Temperatureâ”‚      â”‚Pression â”‚    â”‚ Rythme  â”‚
              â”‚ Corporelleâ”‚      â”‚ArtÃ©rielleâ”‚    â”‚Cardiaqueâ”‚
              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                   â”‚               â”‚               â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  POST /donnees  â”‚ (API REST)
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Endpoint: donnees_medicales_route.py               â”‚
        â”‚  MÃ©thode: create_donnee_route()                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  SERVICE 1: donnee_medical_service.py               â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚ create_donnee_medicale(data)                â”‚    â”‚
        â”‚  â”‚                                             â”‚    â”‚
        â”‚  â”‚ 1. Valider les champs requis               â”‚    â”‚
        â”‚  â”‚    - patient_id âœ“                          â”‚    â”‚
        â”‚  â”‚    - capteur_id âœ“                          â”‚    â”‚
        â”‚  â”‚    - valeur_mesuree âœ“                      â”‚    â”‚
        â”‚  â”‚    - medecin_id âœ“                          â”‚    â”‚
        â”‚  â”‚                                             â”‚    â”‚
        â”‚  â”‚ 2. VÃ©rifier Patient, Capteur, Medecin      â”‚    â”‚
        â”‚  â”‚    dans la BD                              â”‚    â”‚
        â”‚  â”‚                                             â”‚    â”‚
        â”‚  â”‚ 3. CrÃ©er DonneesMedicale                   â”‚    â”‚
        â”‚  â”‚    db.session.add(donnee)                  â”‚    â”‚
        â”‚  â”‚    db.session.flush()  â† GÃ©nÃ¨re donnee.id  â”‚    â”‚
        â”‚  â”‚                                             â”‚    â”‚
        â”‚  â”‚ 4. Appeler create_analyse()                â”‚    â”‚
        â”‚  â”‚    â†“â†“â†“ (voir SERVICE 2)                    â”‚    â”‚
        â”‚  â”‚                                             â”‚    â”‚
        â”‚  â”‚ 5. Commit global                           â”‚    â”‚
        â”‚  â”‚    db.session.commit()                     â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  SERVICE 2: analyse_service.py                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚ create_analyse(patient, medecin, donnee)    â”‚    â”‚
        â”‚  â”‚                                             â”‚    â”‚
        â”‚  â”‚ â”Œâ”€ 1. RÃ©cupÃ©rer le type de capteur       â”€â”â”‚    â”‚
        â”‚  â”‚ â”‚    donnee.capteur.type                 â”‚â”‚    â”‚
        â”‚  â”‚ â”‚    (TypeCapteur.temperature/pression..)â”‚â”‚    â”‚
        â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚
        â”‚  â”‚                                             â”‚    â”‚
        â”‚  â”‚ â”Œâ”€ 2. RÃ©cupÃ©rer les seuils mÃ©dicaux      â”€â”â”‚    â”‚
        â”‚  â”‚ â”‚    seuil = SEUILS_CAPTEURS[type]      â”‚â”‚    â”‚
        â”‚  â”‚ â”‚    {                                   â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      "min": 36.0,                      â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      "max": 37.5,                      â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      "niveau_urgence": CRITIQUE,       â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      "type_alerte": URGENCE            â”‚â”‚    â”‚
        â”‚  â”‚ â”‚    }                                   â”‚â”‚    â”‚
        â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚
        â”‚  â”‚                                             â”‚    â”‚
        â”‚  â”‚ â”Œâ”€ 3. VÃ©rifier l'anomalie                â”€â”â”‚    â”‚
        â”‚  â”‚ â”‚    if valeur < min OR valeur > max:    â”‚â”‚    â”‚
        â”‚  â”‚ â”‚        âš ï¸  ANOMALIE DÃ‰TECTÃ‰E!          â”‚â”‚    â”‚
        â”‚  â”‚ â”‚        â†“â†“â†“ CrÃ©er Alerte               â”‚â”‚    â”‚
        â”‚  â”‚ â”‚    else:                               â”‚â”‚    â”‚
        â”‚  â”‚ â”‚        âœ… Valeur normale               â”‚â”‚    â”‚
        â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚
        â”‚  â”‚                                             â”‚    â”‚
        â”‚  â”‚ â”Œâ”€ 4. CrÃ©er Analyseur (TOUJOURS)        â”€â”â”‚    â”‚
        â”‚  â”‚ â”‚    analyse = Analyseur(                â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      patient_id=patient.id,            â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      medecin_id=medecin.id,            â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      donnee_medicale_id=donnee.id,     â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      resultat=resultat_string          â”‚â”‚    â”‚
        â”‚  â”‚ â”‚    )                                   â”‚â”‚    â”‚
        â”‚  â”‚ â”‚    db.session.add(analyse)             â”‚â”‚    â”‚
        â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚
        â”‚  â”‚                                             â”‚    â”‚
        â”‚  â”‚ â”Œâ”€ 5. Si anomalie: CrÃ©er Alerte        â”€â”â”‚    â”‚
        â”‚  â”‚ â”‚    alerte = Alerte(                   â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      patient_id=patient.id,           â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      medecin_id=medecin.id,           â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      niveau_urgence=CRITIQUE,         â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      type_alerte=URGENCE,             â”‚â”‚    â”‚
        â”‚  â”‚ â”‚      description=resultat_string      â”‚â”‚    â”‚
        â”‚  â”‚ â”‚    )                                  â”‚â”‚    â”‚
        â”‚  â”‚ â”‚    db.session.add(alerte)             â”‚â”‚    â”‚
        â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  BASE DONNÃ‰ES  â”‚              â”‚ OBJETS CRÃ‰Ã‰S        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ donnees_       â”‚ INSERT       â”‚ âœ… DonneesMedicale  â”‚
        â”‚ medicales      â”‚â”€â”€â”€â”€â”€â”€â”€â”      â”‚                     â”‚
        â”‚ (1 ligne)      â”‚       â”‚      â”‚ âœ… Analyseur        â”‚
        â”‚                â”‚       â”‚      â”‚                     â”‚
        â”‚ analyseur      â”‚ INSERTâ”‚      â”‚ âœ… Alerte           â”‚
        â”‚ (1 ligne)      â”‚â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â†’â”‚    (si anomalie)    â”‚
        â”‚                â”‚       â”‚      â”‚                     â”‚
        â”‚ alerte         â”‚ INSERTâ”‚      â”‚ ğŸ“Š Statistiques:    â”‚
        â”‚ (0 ou 1)       â”‚â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    - DonneesMedicaleâ”‚
        â”‚                â”‚              â”‚    - Analyseur: 1/1 â”‚
        â”‚                â”‚              â”‚    - Alerte: si ano â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Diagramme Comparatif: AVANT vs APRÃˆS

### âŒ AVANT (Broken - Insertion directe)
```
DonneesMedicale(patient=6, capteur=1, valeur=40)
    â†“
db.session.add_all([*donnees])
db.session.commit()
    â†“
BD: DonneesMedicale âœ…
    Analyseur âŒ (MANQUANT!)
    Alerte âŒ (MANQUANT!)
```

### âœ… APRÃˆS (Fixed - Via service)
```
create_donnee_medicale({
    patient_id=6, capteur_id=1, 
    valeur_mesuree=35.0, medecin_id=1
})
    â†“
SERVICE dÃ©clenche automatiquement:
    â”œâ”€ CrÃ©e DonneesMedicale âœ…
    â”œâ”€ CrÃ©e Analyseur âœ…
    â””â”€ CrÃ©e Alerte (si anomalie) âœ…
    â†“
BD: TOUT est crÃ©Ã©, tout est liÃ©!
```

---

## Contexte des Tables et Relations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PATIENT         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)             â”‚
â”‚ nom                 â”‚
â”‚ email               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1:N
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                         â”‚
       â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                    â”‚   DONNEES_MEDICALES                 â”‚
       â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                    â”‚ id (PK)                           â”‚
       â”‚                    â”‚ patient_id (FK)  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚ capteur_id (FK)  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                    â”‚ valeur_mesuree                 â”‚
       â”‚                    â”‚ date_heure_mesure              â”‚
       â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                           â”‚ 1:N
       â”‚                           â”‚
       â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                    â”‚   ANALYSEUR            â”‚
       â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                    â”‚ id (PK)              â”‚
       â”‚                    â”‚ patient_id (FK) â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚ medecin_id (FK)      â”‚
       â”‚                    â”‚ donnee_medicale_id   â”‚
       â”‚                    â”‚ resultat             â”‚
       â”‚                    â”‚ date_analyse         â”‚
       â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                â”‚
       â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚        â”‚        ALERTE                        â”‚
       â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚        â”‚ id (PK)                            â”‚
       â”‚        â”‚ patient_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚        â”‚ medecin_id (FK)  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚        â”‚ niveau_urgence             â”‚
       â”‚        â”‚ type_alerte                â”‚
       â”‚        â”‚ description                â”‚
       â”‚        â”‚ etat_traitement            â”‚
       â”‚        â”‚ date_heure_alerte          â”‚
       â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚          MEDECIN                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                                     â”‚
â”‚ nom                                         â”‚
â”‚ email                                       â”‚
â”‚ specialite                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       CAPTEUR                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                         â”‚
â”‚ type (FK: TypeCapteur enum)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ 1:N
             â”‚
             â””â”€â”€â†’ DONNEES_MEDICALES.capteur_id
```

---

## Flux DÃ©taillÃ© des Seuils

```
SEUILS_CAPTEURS (app/utils/seuils.py)
â”‚
â”œâ”€ TypeCapteur.temperature
â”‚  â”œâ”€ min: 36.0Â°C
â”‚  â”œâ”€ max: 37.5Â°C
â”‚  â”œâ”€ niveau_urgence: UrgenceEnum.critique âœ… (enum, pas string!)
â”‚  â””â”€ type_alerte: TypeAlerte.urgence âœ… (enum, pas string!)
â”‚
â”œâ”€ TypeCapteur.pression
â”‚  â”œâ”€ min: 90 mmHg
â”‚  â”œâ”€ max: 140 mmHg
â”‚  â”œâ”€ niveau_urgence: UrgenceEnum.critique
â”‚  â””â”€ type_alerte: TypeAlerte.urgence
â”‚
â””â”€ TypeCapteur.rythme
   â”œâ”€ min: 60 bpm
   â”œâ”€ max: 100 bpm
   â”œâ”€ niveau_urgence: UrgenceEnum.moyenne
   â””â”€ type_alerte: TypeAlerte.avertissement
```

---

## Timeline d'ExÃ©cution

```
T0:00  POST /v1/donnees avec valeur=35.0 (Temperature)
       â”‚
T0:10  â”œâ”€ create_donnee_route()
       â”‚
T0:20  â”œâ”€ create_donnee_medicale(data)
       â”‚  â”œâ”€ Valider champs âœ“
       â”‚  â”œâ”€ VÃ©rifier Patient âœ“
       â”‚  â”œâ”€ VÃ©rifier Capteur âœ“
       â”‚  â”œâ”€ VÃ©rifier Medecin âœ“
       â”‚
T0:30  â”‚  â”œâ”€ CrÃ©er DonneesMedicale
       â”‚  â”‚  db.session.add()
       â”‚  â”‚  db.session.flush()  â† GÃ©nÃ¨re ID
       â”‚  â”‚  ID=17
       â”‚
T0:40  â”‚  â”œâ”€ create_analyse(patient, medecin, donnee)
       â”‚  â”‚  â”œâ”€ RÃ©cupÃ©rer seuil Temperature [36.0-37.5]
       â”‚  â”‚  â”œâ”€ Comparer 35.0 < 36.0 ? OUI âš ï¸
       â”‚  â”‚  â”‚
       â”‚  â”‚  â”œâ”€ CrÃ©er Alerte
       â”‚  â”‚  â”‚  â”œâ”€ patient_id = 6
       â”‚  â”‚  â”‚  â”œâ”€ medecin_id = 1
       â”‚  â”‚  â”‚  â”œâ”€ niveau_urgence = CRITIQUE
       â”‚  â”‚  â”‚  â”œâ”€ type_alerte = URGENCE
       â”‚  â”‚  â”‚  â””â”€ description = "Anomalie dÃ©tectÃ©e..."
       â”‚  â”‚  â”‚  db.session.add(alerte)
       â”‚  â”‚  â”‚
       â”‚  â”‚  â”œâ”€ CrÃ©er Analyseur
       â”‚  â”‚  â”‚  â”œâ”€ patient_id = 6
       â”‚  â”‚  â”‚  â”œâ”€ medecin_id = 1
       â”‚  â”‚  â”‚  â”œâ”€ donnee_medicale_id = 17
       â”‚  â”‚  â”‚  â”œâ”€ resultat = "Anomalie..."
       â”‚  â”‚  â”‚  â””â”€ db.session.add(analyse)
       â”‚
T0:50  â”‚  â””â”€ db.session.commit()
       â”‚     â”œâ”€ INSERT donnees_medicales (1 row)
       â”‚     â”œâ”€ INSERT analyseur (1 row)
       â”‚     â””â”€ INSERT alerte (1 row)
       â”‚
T1:00  â””â”€ RÃ©ponse 201 Created
            {
              "message": "DonnÃ©e crÃ©Ã©e",
              "donnee": { "id": 17, ... }
            }

BASE DE DONNEES:
    donnees_medicales: ID 17, temp=35.0, date_heure=T0:00
    analyseur: ID ???, donnee_id=17, resultat="Anomalie...", date=T0:00
    alerte: ID ???, patient_id=6, medecin_id=1, urgent=CRITIQUE
```

---

## RÃ©sumÃ© Graphique

```
ğŸ¯ OBJECTIF: DonnÃ©es mÃ©dicales â†’ Analyse automatique â†’ Alertes si anomalie

ğŸ“Š PIPELINE:
   Capteur
      â†“
   DonnÃ©e
      â†“
   Analyse (logique mÃ©dicale)
      â”œâ”€ Normal â†’ Analyseur seulement
      â””â”€ Anomalie â†’ Analyseur + Alerte

âœ… IMPLÃ‰MENTATION:
   Service â†’ BD â†’ RÃ©sultats
   
ğŸ”§ CORRECTION:
   Bug: Insertion directe â†’ Service avec analyse
   Bug: Enum.value â†’ Enum object
   Result: âœ… Pipeline complet et opÃ©rationnel
```

---

*Diagramme crÃ©Ã© le 22 DÃ©cembre 2025*
*Version du pipeline: 1.0*
